name: Test FB Messenger Webhook

on:
  workflow_dispatch:

permissions: {}

jobs:
  test-webhook:
    runs-on: ubuntu-latest
    steps:
      - name: Test webhook endpoint
        env:
          FB_VERIFY_TOKEN: ${{ secrets.FB_VERIFY_TOKEN }}
        run: |
          RESPONSE=$(curl -s -o /dev/null -w "%{http_code}" \
            "https://kelionai.app/api/messenger/webhook?hub.mode=subscribe&hub.verify_token=${FB_VERIFY_TOKEN}&hub.challenge=test123")
          echo "Response code: $RESPONSE"
          if [ "$RESPONSE" = "200" ]; then
            echo "✅ Webhook functional!"
          else
            echo "❌ Webhook not responding correctly"
            exit 1
          fi
