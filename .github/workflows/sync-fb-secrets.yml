name: Sync FB Messenger Secrets to Railway

on:
  workflow_dispatch:
    inputs:
      fb_page_access_token:
        description: 'FB_PAGE_ACCESS_TOKEN from developers.facebook.com'
        required: true
        type: string
      fb_app_secret:
        description: 'FB_APP_SECRET from Facebook App Settings > Basic'
        required: true
        type: string
      fb_verify_token:
        description: 'FB_VERIFY_TOKEN (any random string)'
        required: false
        default: 'kelion-messenger-2026'
        type: string

jobs:
  sync-secrets:
    runs-on: ubuntu-latest
    permissions: {}
    steps:
      - name: Install Railway CLI
        run: npm install -g @railway/cli

      - name: Set FB_PAGE_ACCESS_TOKEN in Railway
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
          FB_PAGE_ACCESS_TOKEN: ${{ github.event.inputs.fb_page_access_token }}
        run: |
          railway variables set FB_PAGE_ACCESS_TOKEN="$FB_PAGE_ACCESS_TOKEN"

      - name: Set FB_APP_SECRET in Railway
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
          FB_APP_SECRET: ${{ github.event.inputs.fb_app_secret }}
        run: |
          railway variables set FB_APP_SECRET="$FB_APP_SECRET"

      - name: Set FB_VERIFY_TOKEN in Railway
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
          FB_VERIFY_TOKEN: ${{ github.event.inputs.fb_verify_token }}
        run: |
          railway variables set FB_VERIFY_TOKEN="$FB_VERIFY_TOKEN"

      - name: Verify variables set
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
        run: |
          echo "âœ… FB Messenger secrets synced to Railway!"
          railway variables list | grep FB_
