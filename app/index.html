<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="sentry-dsn" content="">
    <meta name="theme-color" content="#050510">
    <link rel="manifest" href="/manifest.json">
    <title>KelionAI</title>
    <script>
        // â”€â”€â”€ Onboarding redirect (first visit) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        try {
            if (!localStorage.getItem('kelion_onboarded')) {
                window.location.replace('/onboarding.html');
                throw new Error('redirect');
            }
        } catch (e) {
            if (e.message === 'redirect') throw e;
        }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500&display=swap">
    <link rel="stylesheet" href="/styles/design-system.css">
    <link rel="stylesheet" href="/styles/components.css">
    <link rel="stylesheet" href="/styles/animations.css">
    <link rel="stylesheet" href="/css/app.css">
    <style>
        /* â”€â”€â”€ Splash Screen Premium â”€â”€â”€ */
        .splash {
            position: fixed; inset: 0;
            background: #050510;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.6s ease, visibility 0.6s;
        }
        .splash.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
        .splash-logo {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .splash .animate-glow {
            animation: splashGlow 2.5s ease-in-out infinite alternate;
        }
        @keyframes splashGlow {
            from { filter: drop-shadow(0 0 12px rgba(99,102,241,0.4)); }
            to   { filter: drop-shadow(0 0 32px rgba(6,182,212,0.5)); }
        }
        .splash .typing-indicator { margin-top: 28px; }
        .splash .typing-indicator span {
            width: 8px; height: 8px;
            background: var(--kelion-primary, #6366F1);
        }

        /* â”€â”€â”€ PWA Install Banner Premium â”€â”€â”€ */
        .pwa-banner {
            position: fixed;
            bottom: 24px; left: 50%;
            transform: translateX(-50%);
            background: var(--kelion-glass, rgba(10,10,30,0.6));
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--kelion-glass-border, rgba(99,102,241,0.15));
            border-radius: var(--kelion-radius-lg, 20px);
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 16px;
            box-shadow: var(--kelion-shadow-lg, 0 8px 48px rgba(0,0,0,0.6));
            z-index: 1500;
            max-width: 420px;
            width: calc(100% - 48px);
            animation: slideUp 0.4s ease;
        }
        .pwa-banner-content {
            display: flex; align-items: center; gap: 12px; flex: 1;
        }
        .pwa-banner-content > span { font-size: 1.6rem; }
        .pwa-banner-content strong { color: var(--kelion-text, #F0F0FF); font-size: 0.9rem; }
        .pwa-banner-content p { color: var(--kelion-text-secondary, #8888AA); font-size: 0.78rem; margin: 2px 0 0; }
        .pwa-banner-actions { display: flex; gap: 8px; flex-shrink: 0; }
        .pwa-btn-primary {
            padding: 8px 16px; font-size: 13px; font-weight: 600;
            background: var(--kelion-gradient); color: #fff;
            border: none; border-radius: var(--kelion-radius-sm, 8px); cursor: pointer;
            font-family: var(--kelion-font); transition: var(--kelion-transition);
        }
        .pwa-btn-primary:hover { opacity: 0.88; transform: translateY(-1px); }
        .pwa-btn-secondary {
            padding: 8px 14px; font-size: 13px;
            background: rgba(255,255,255,0.05); color: var(--kelion-text-secondary, #8888AA);
            border: 1px solid var(--kelion-border, rgba(99,102,241,0.12)); border-radius: var(--kelion-radius-sm, 8px);
            cursor: pointer; font-family: var(--kelion-font); transition: var(--kelion-transition);
        }
        .pwa-btn-secondary:hover { background: rgba(255,255,255,0.08); color: var(--kelion-text); }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.17.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.3/dist/coco-ssd.min.js"></script>
    <script src="https://browser.sentry-cdn.com/8.46.0/bundle.tracing.replay.min.js" crossorigin="anonymous"></script>
    <script>
        var _sentryDsn = (document.querySelector('meta[name="sentry-dsn"]') || {}).content;
        if (window.Sentry && _sentryDsn) Sentry.init({
            dsn: _sentryDsn,
            integrations: [Sentry.browserTracingIntegration(), Sentry.replayIntegration()],
            tracesSampleRate: 1.0, replaysOnErrorSampleRate: 1.0
        });
    </script>

    <script src="https://cdn.lr-in-prod.com/LogRocket.min.js"></script>
    <script>LogRocket.init('bdaej1/kelionai');</script>
</head>
<body>

    <!-- SPLASH SCREEN -->
    <div id="splash-screen" class="splash">
        <div class="splash-logo animate-glow">
            <span style="font-size:52px;font-weight:900;color:#F0F0FF">Kelion</span>
            <span class="gradient-text" style="font-size:52px;font-weight:900">AI</span>
        </div>
        <div class="typing-indicator" style="margin-top:28px">
            <span></span><span></span><span></span>
        </div>
        <p style="margin-top:16px;color:#555577;font-size:0.8rem;letter-spacing:1px">YOUR INTELLIGENT ASSISTANT</p>
    </div>

    <!-- AUTH SCREEN -->
    <div id="auth-screen">
        <div id="auth-container">
            <div id="auth-logo">
                <div class="auth-avatar-icon animate-float">ðŸ¤–</div>
                <h1>Kelion<span class="gradient-text">AI</span></h1>
                <p class="auth-subtitle" data-i18n="auth.subtitle">Your smart AI assistant</p>
            </div>
            <form id="auth-form">
                <h2 id="auth-title" data-i18n="auth.title">Sign In</h2>
                <div id="auth-name-group" style="display:none">
                    <input type="text" id="auth-name" data-i18n-placeholder="auth.name.placeholder" placeholder="Your name" autocomplete="name">
                </div>
                <div><input type="email" id="auth-email" data-i18n-placeholder="auth.email.placeholder" placeholder="Email" autocomplete="email" required></div>
                <div><input type="password" id="auth-password" data-i18n-placeholder="auth.password.placeholder" placeholder="Password" autocomplete="current-password" required></div>
                <div id="auth-forgot" style="text-align:right;margin-top:-4px"><a href="#" id="auth-forgot-link" data-i18n="auth.forgot_password" style="font-size:0.8rem;color:var(--kelion-text-secondary)">Forgot password?</a></div>
                <div id="auth-error"></div>
                <button type="submit" id="auth-submit" data-i18n="auth.submit">Sign In</button>
                <a href="#" id="auth-toggle" data-i18n="auth.toggle">No account â†’ Create</a>
            </form>
            <button id="auth-guest" class="auth-guest-btn" data-i18n="auth.guest">Continue without account</button>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="app-layout" class="hidden">

        <!-- NAVBAR -->
        <nav class="navbar" id="app-navbar">
            <a href="/" class="navbar-logo"><span id="navbar-avatar-name">Kelion</span><span>AI</span></a>
            <div id="status-indicator" style="margin-left: 10px; display: inline-flex; align-items: center; gap: 6px; font-size: 0.75rem; color: var(--kelion-text-secondary); opacity: 0.8;">
                <div id="status-dot" style="width: 8px; height: 8px; border-radius: 50%; background: #10B981; box-shadow: 0 0 10px rgba(16,185,129,0.5);"></div>
                <span id="status-text">Online</span>
            </div>
            <ul class="navbar-links">
                <li><a href="/" data-i18n="nav.home">Home</a></li>
                <li><a href="/#features" data-i18n="nav.features">Features</a></li>
                <li><a href="/pricing/" data-i18n="nav.pricing">Pricing</a></li>
                <li><a href="/developer" data-i18n="nav.developer">Developer</a></li>
                <li><a href="/settings/" data-i18n="nav.settings">Settings</a></li>
            </ul>
            <div class="navbar-right">
                <button class="btn-primary" id="navbar-get-started" style="padding:8px 18px;font-size:0.85rem;" data-i18n="nav.get_started">Get Started</button>
                <button class="navbar-hamburger" id="navbar-hamburger" aria-label="Menu">
                    <span></span><span></span><span></span>
                </button>
            </div>
        </nav>

        <!-- MOBILE NAV MENU -->
        <div class="navbar-mobile-menu" id="navbar-mobile-menu">
            <a href="/" data-i18n="nav.home">Home</a>
            <a href="/#features" data-i18n="nav.features">Features</a>
            <a href="/pricing/" data-i18n="nav.pricing">Pricing</a>
            <a href="/developer" data-i18n="nav.developer">Developer</a>
            <a href="/settings/" data-i18n="nav.settings">Settings</a>
        </div>

        <!-- MAIN CONTENT -->
        <div id="main-content">

        <!-- CONVERSATION HISTORY SIDEBAR -->
        <div id="history-sidebar" class="hidden">
            <div id="history-header">
                <h3 data-i18n="history.title">Conversations</h3>
                <button id="btn-new-chat" title="New conversation">ï¼‹</button>
                <button id="btn-close-history" title="Close">âœ•</button>
            </div>
            <div id="history-list"></div>
        </div>

        <div id="left-panel">
            <div id="avatar-area">
                <canvas id="avatar-canvas"></canvas>
                <div id="avatar-label">
                    <span id="avatar-name" style="display:none">Kelion</span>
                </div>
                <div id="avatar-switcher">
                    <button class="avatar-pill active" data-avatar="kelion">Kelion</button>
                    <button class="avatar-pill" data-avatar="kira">Kira</button>
                    <button class="ctrl-btn-sm" id="btn-history" title="Conversation history" aria-label="Conversation history">ðŸ“‹</button>
                    <span id="user-name" class="user-badge">Guest</span>
                    <button class="ctrl-btn-sm" id="btn-auth" title="Sign in">ðŸ”‘</button>
                    <button class="ctrl-btn-sm" id="btn-pricing" title="Pricing" aria-label="Pricing">ðŸ’Ž</button>
                    <a href="/developer" class="ctrl-btn-sm" title="Developer API" style="text-decoration:none;display:inline-flex;align-items:center;justify-content:center">âš¡</a>
                </div>
            </div>
            <div id="chat-area">
                <div id="chat-overlay"></div>
                <div id="thinking">
                    <div class="thinking-dots"><span></span><span></span><span></span></div>
                    <span data-i18n="thinking.text">Thinking...</span>
                </div>
                <div id="input-row">
                    <button id="btn-mic" title="Voice input" aria-label="Voice input">ðŸŽ¤</button>
                    <input type="text" id="text-input" data-i18n-placeholder="input.placeholder" placeholder="Type or speak..." autocomplete="off">
                    <button id="btn-send">âž¤</button>
                </div>
            </div>
        </div>
        <div id="display-panel">
            <div id="display-header"><span id="display-title" data-i18n="monitor.title">Monitor</span></div>
            <div id="display-content">
                <div id="monitor-image" style="display:none"></div>
                <div id="monitor-map" style="display:none"></div>
                <div id="monitor-text" style="display:none"></div>
                <div id="monitor-search" style="display:none"></div>
                <div id="monitor-weather" style="display:none"></div>
                <div id="monitor-default">
                    <div class="welcome-icon animate-float">ðŸŽ¯</div>
                    <p data-i18n="monitor.default.text">The monitor will display content when the AI assistant shares information.</p>
                    <small data-i18n="monitor.default.hint">Say "what's ahead" or "show me a map"</small>
                </div>
            </div>
        </div>
        </div><!-- /#main-content -->
    </div><!-- /#app-layout -->

    <div id="drop-zone" class="hidden">
        <div class="drop-zone-content"><div class="drop-icon animate-float">ðŸ“‚</div><p data-i18n="drop.text">Drop file here</p></div>
    </div>

    <!-- PRICING MODAL -->
    <div id="pricing-modal" class="modal-overlay hidden">
        <div class="modal-content pricing-modal">
            <button class="modal-close" id="pricing-close">&times;</button>
            <h2 class="pricing-title" data-i18n="pricing.modal.title">Choose your plan</h2>
            <div id="current-plan-info" class="current-plan-info"></div>
            <div class="pricing-grid" id="pricing-grid"></div>
            <div id="pricing-referral" class="pricing-referral"></div>
        </div>
    </div>

    <!-- TICKER BAR -->
    <div id="ticker-bar" class="ticker-bar hidden">
      <span id="ticker-text"></span>
      <button id="ticker-disable" class="ticker-disable hidden" title="Disable ticker">âœ•</button>
    </div>

    <script src="/lib/three.bundle.js"></script>
    <script src="/js/i18n.js"></script>
    <script src="/js/fft-lipsync.js"></script>
    <script src="/js/avatar.js"></script>
    <script src="/js/voice.js"></script>
    <script src="/js/realtime-vision.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/monitor.js"></script>
    <script src="/js/tools.js"></script>
    <script src="/js/shared.js"></script>
    <script src="/js/payments-ui.js"></script>
    <script src="/js/ticker.js"></script>
    <script src="/js/app.js"></script>
    <script src="/js/navbar.js"></script>

    <!-- PWA INSTALL BANNER -->
    <div id="pwa-install-banner" class="pwa-banner" style="display:none">
        <div class="pwa-banner-content">
            <span>ðŸ“±</span>
            <div>
                <strong data-i18n="pwa.title">Install KelionAI</strong>
                <p data-i18n="pwa.subtitle">Quick access from your screen</p>
            </div>
        </div>
        <div class="pwa-banner-actions">
            <button id="pwa-install-btn" class="pwa-btn-primary" data-i18n="pwa.install">Install</button>
            <button id="pwa-dismiss-btn" class="pwa-btn-secondary" data-i18n="pwa.dismiss">Not now</button>
        </div>
    </div>

    <script>
        // â”€â”€â”€ PWA Install banner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        var deferredInstallPrompt = null;
        window.addEventListener('beforeinstallprompt', function (e) {
            e.preventDefault();
            deferredInstallPrompt = e;
            try {
                var dismissed = localStorage.getItem('pwa_dismissed');
                if (dismissed && Date.now() - Number(dismissed) < 7 * 24 * 60 * 60 * 1000) return;
            } catch (e2) {}
            var banner = document.getElementById('pwa-install-banner');
            if (banner) banner.style.display = 'flex';
        });
        var installBtn = document.getElementById('pwa-install-btn');
        if (installBtn) {
            installBtn.addEventListener('click', function () {
                var banner = document.getElementById('pwa-install-banner');
                if (banner) banner.style.display = 'none';
                if (deferredInstallPrompt) {
                    deferredInstallPrompt.prompt();
                    deferredInstallPrompt.userChoice.then(function () { deferredInstallPrompt = null; });
                }
            });
        }
        var dismissBtn = document.getElementById('pwa-dismiss-btn');
        if (dismissBtn) {
            dismissBtn.addEventListener('click', function () {
                var banner = document.getElementById('pwa-install-banner');
                if (banner) banner.style.display = 'none';
                try { localStorage.setItem('pwa_dismissed', Date.now()); } catch (e) {}
            });
        }
    </script>
</body>
</html>
