<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KelionAI ‚Äî Sports Dashboard (Admin)</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#0a0a1a;color:#e0e0e0;font-family:system-ui,sans-serif;min-height:100vh}
header{background:rgba(0,255,136,0.08);border-bottom:1px solid rgba(0,255,136,0.2);padding:16px 24px;display:flex;align-items:center;gap:12px;flex-wrap:wrap}
header h1{color:#00ff88;font-size:1.4rem;flex:1}
.disclaimer-banner{background:rgba(255,170,0,0.12);border:1px solid rgba(255,170,0,0.4);color:#ffaa00;padding:10px 20px;font-size:0.82rem;text-align:center;line-height:1.4}
.tabs{display:flex;gap:0;background:rgba(255,255,255,0.04);border-bottom:1px solid rgba(255,255,255,0.1);overflow-x:auto}
.tab{padding:12px 20px;cursor:pointer;border:none;background:none;color:#888;font-size:0.9rem;white-space:nowrap;transition:all .2s;border-bottom:2px solid transparent}
.tab:hover{color:#e0e0e0}
.tab.active{color:#00ff88;border-bottom-color:#00ff88}
.content{padding:20px;max-width:1400px;margin:0 auto}
.section-title{font-size:1.1rem;color:#aaa;margin-bottom:16px;display:flex;align-items:center;gap:8px}
.section-title .refresh-btn{margin-left:auto;background:rgba(0,255,136,0.1);border:1px solid rgba(0,255,136,0.3);color:#00ff88;padding:6px 14px;border-radius:8px;cursor:pointer;font-size:0.8rem;transition:all .2s}
.section-title .refresh-btn:hover{background:rgba(0,255,136,0.2)}
.cards-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:14px;margin-bottom:24px}
.card{background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:12px;padding:16px;cursor:pointer;transition:all .2s;position:relative}
.card:hover{border-color:rgba(0,255,136,0.4);background:rgba(0,255,136,0.05)}
.card .sport-badge{font-size:0.75rem;color:#888;margin-bottom:8px}
.card .teams{display:flex;align-items:center;gap:10px;margin-bottom:10px}
.card .team-logo{width:32px;height:32px;object-fit:contain;border-radius:4px;background:rgba(255,255,255,0.05)}
.card .team-logo-placeholder{width:32px;height:32px;background:rgba(255,255,255,0.08);border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:16px}
.card .team-name{font-weight:600;font-size:0.95rem;flex:1}
.card .vs{color:#555;font-size:0.8rem;padding:0 4px}
.card .score{font-size:1.4rem;font-weight:bold;color:#00ff88;text-align:center;padding:4px 10px;background:rgba(0,255,136,0.08);border-radius:8px}
.card .meta{font-size:0.78rem;color:#666;margin-top:8px;display:flex;gap:10px;flex-wrap:wrap}
.card .status-live{color:#ff4444;font-weight:bold;font-size:0.78rem}
.card .status-upcoming{color:#00aaff;font-size:0.78rem}
.live-dot{display:inline-block;width:8px;height:8px;background:#ff4444;border-radius:50%;margin-right:4px;animation:pulse 1s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.3}}
.empty-state{text-align:center;padding:40px;color:#555}
.loading{text-align:center;padding:40px;color:#555}
.spinner{display:inline-block;width:24px;height:24px;border:2px solid rgba(0,255,136,0.3);border-top-color:#00ff88;border-radius:50%;animation:spin 0.8s linear infinite;margin-right:8px;vertical-align:middle}
@keyframes spin{to{transform:rotate(360deg)}}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,0.8);z-index:100;display:none;align-items:center;justify-content:center;padding:20px}
.overlay.open{display:flex}
.overlay-box{background:#111827;border:1px solid rgba(0,255,136,0.3);border-radius:16px;padding:28px;max-width:600px;width:100%;max-height:80vh;overflow-y:auto;position:relative}
.overlay-box h2{color:#00ff88;margin-bottom:16px;font-size:1.1rem}
.overlay-close{position:absolute;top:14px;right:16px;background:none;border:none;color:#888;font-size:1.4rem;cursor:pointer}
.overlay-close:hover{color:#e0e0e0}
.analysis-text{white-space:pre-wrap;font-size:0.88rem;line-height:1.6;color:#ddd}
.form-row{display:flex;gap:8px;align-items:center;margin:6px 0}
.form-pill{display:inline-block;width:22px;height:22px;border-radius:50%;text-align:center;line-height:22px;font-size:0.75rem;font-weight:bold}
.form-W{background:#00ff88;color:#000}
.form-D{background:#ffaa00;color:#000}
.form-L{background:#ff4444;color:#fff}
.form-?{background:#444;color:#fff}
.auth-bar{display:flex;align-items:center;gap:8px}
.auth-bar input{background:rgba(255,255,255,0.07);border:1px solid rgba(255,255,255,0.2);color:#e0e0e0;padding:6px 12px;border-radius:8px;font-size:0.85rem;width:200px}
.auth-bar button{background:rgba(0,255,136,0.15);border:1px solid rgba(0,255,136,0.4);color:#00ff88;padding:6px 14px;border-radius:8px;cursor:pointer;font-size:0.85rem}
.error-msg{background:rgba(255,68,68,0.1);border:1px solid rgba(255,68,68,0.3);color:#ff6666;padding:10px 16px;border-radius:8px;margin-bottom:16px;font-size:0.85rem}
</style>
</head>
<body>

<header>
    <h1>üèÜ KelionAI Sports Dashboard</h1>
    <div class="auth-bar">
        <input type="password" id="adminKey" placeholder="Admin secret key" />
        <button onclick="loadAll()">Connect</button>
    </div>
</header>

<div class="disclaimer-banner">
    ‚ö†Ô∏è Sports analysis for informational purposes only. KelionAI <strong>NEVER</strong> guarantees match outcomes.
    Betting involves financial risk. Never bet more than you can afford to lose.
    If you have a gambling problem, seek help.
</div>

<div class="tabs">
    <button class="tab active" onclick="switchTab(this, 'all')">üèÜ All Sports</button>
    <button class="tab" onclick="switchTab(this, 'Football')">‚öΩ Football</button>
    <button class="tab" onclick="switchTab(this, 'Basketball')">üèÄ Basketball</button>
    <button class="tab" onclick="switchTab(this, 'Tennis')">üéæ Tennis</button>
    <button class="tab" onclick="switchTab(this, 'F1')">üèéÔ∏è F1</button>
    <button class="tab" onclick="switchTab(this, 'NFL')">üèà NFL</button>
</div>

<div class="content">
    <div id="errorArea"></div>

    <!-- Live Scores -->
    <div>
        <div class="section-title">
            üî¥ Live Scores
            <button class="refresh-btn" onclick="loadLive()">‚Üª Refresh</button>
        </div>
        <div class="cards-grid" id="liveCards">
            <div class="loading"><span class="spinner"></span>Loading live scores‚Ä¶</div>
        </div>
    </div>

    <!-- Upcoming Matches -->
    <div>
        <div class="section-title">
            üìÖ Upcoming Matches
            <button class="refresh-btn" onclick="loadUpcoming()">‚Üª Refresh</button>
        </div>
        <div class="cards-grid" id="upcomingCards">
            <div class="loading"><span class="spinner"></span>Loading upcoming matches‚Ä¶</div>
        </div>
    </div>
</div>

<!-- Analysis Overlay -->
<div class="overlay" id="overlay">
    <div class="overlay-box">
        <button class="overlay-close" onclick="closeOverlay()">‚úï</button>
        <h2 id="overlayTitle">Match Analysis</h2>
        <div id="overlayContent"></div>
        <div style="margin-top:16px;padding:12px;background:rgba(255,170,0,0.08);border:1px solid rgba(255,170,0,0.3);border-radius:8px;font-size:0.78rem;color:#ffaa00">
            ‚ö†Ô∏è For informational purposes only. KelionAI NEVER guarantees match outcomes.
        </div>
    </div>
</div>

<script>
'use strict';

let currentSport = 'all';
let liveData = [];
let upcomingData = [];

function adminKey() {
    return document.getElementById('adminKey').value.trim();
}

function showError(msg) {
    const area = document.getElementById('errorArea');
    area.innerHTML = msg
        ? `<div class="error-msg">‚ö†Ô∏è ${msg}</div>`
        : '';
}

async function apiFetch(path) {
    const res = await fetch(path, {
        headers: { 'x-admin-secret': adminKey() }
    });
    if (!res.ok) {
        const err = await res.json().catch(() => ({}));
        throw new Error(err.error || `HTTP ${res.status}`);
    }
    return res.json();
}

function teamLogo(url, fallbackIcon) {
    if (url) {
        return `<img class="team-logo" src="${url}" alt="" onerror="this.style.display='none'">`;
    }
    return `<div class="team-logo-placeholder">${fallbackIcon || 'üèÖ'}</div>`;
}

function sportIcon(sport) {
    const icons = { Football: '‚öΩ', Basketball: 'üèÄ', Tennis: 'üéæ', F1: 'üèéÔ∏è', NFL: 'üèà' };
    return icons[sport] || 'üèÖ';
}

function renderFormPills(formStr) {
    if (!formStr || formStr === 'N/A') return '<span style="color:#555">N/A</span>';
    return formStr.split(' ').map(r => `<span class="form-pill form-${r}">${r}</span>`).join(' ');
}

function filterBySport(arr) {
    if (currentSport === 'all') return arr;
    return arr.filter(e => (e.sport || '').toLowerCase().includes(currentSport.toLowerCase()) ||
                           (e.league || '').toLowerCase().includes(currentSport.toLowerCase()));
}

function renderLiveCards(events) {
    const container = document.getElementById('liveCards');
    const filtered = filterBySport(events);
    if (!filtered.length) {
        container.innerHTML = '<div class="empty-state">No live events right now</div>';
        return;
    }
    container.innerHTML = filtered.map(e => `
        <div class="card" onclick="openMatchAnalysis('${e.id}', '${escHtml(e.homeTeam)} vs ${escHtml(e.awayTeam)}')">
            <div class="sport-badge">${sportIcon(e.sport)} ${e.league || e.sport}</div>
            <div class="teams">
                ${teamLogo(e.homeLogoUrl, sportIcon(e.sport))}
                <span class="team-name">${escHtml(e.homeTeam)}</span>
                <span class="vs">vs</span>
                <span class="team-name">${escHtml(e.awayTeam)}</span>
                ${teamLogo(e.awayLogoUrl, sportIcon(e.sport))}
            </div>
            ${(e.homeScore !== null && e.homeScore !== undefined)
                ? `<div class="score">${e.homeScore} ‚Äì ${e.awayScore}</div>`
                : ''}
            <div class="meta">
                <span class="status-live"><span class="live-dot"></span>${e.status || 'Live'}</span>
                ${e.time ? `<span>${e.time}'</span>` : ''}
            </div>
        </div>`).join('');
}

function renderUpcomingCards(events) {
    const container = document.getElementById('upcomingCards');
    const filtered = filterBySport(events);
    if (!filtered.length) {
        container.innerHTML = '<div class="empty-state">No upcoming matches found</div>';
        return;
    }
    container.innerHTML = filtered.map(e => `
        <div class="card" onclick="openMatchAnalysis('${e.id}', '${escHtml(e.homeTeam)} vs ${escHtml(e.awayTeam)}')">
            <div class="sport-badge">${e.icon || sportIcon(e.sport)} ${e.league}</div>
            <div class="teams">
                ${teamLogo(e.homeLogoUrl, e.icon || sportIcon(e.sport))}
                <span class="team-name">${escHtml(e.homeTeam)}</span>
                <span class="vs">vs</span>
                <span class="team-name">${escHtml(e.awayTeam)}</span>
                ${teamLogo(e.awayLogoUrl, e.icon || sportIcon(e.sport))}
            </div>
            <div class="meta">
                <span class="status-upcoming">üìÖ ${e.date}${e.time ? ' ' + e.time : ''}</span>
                ${e.venue ? `<span>üìç ${escHtml(e.venue)}</span>` : ''}
            </div>
        </div>`).join('');
}

async function loadLive() {
    document.getElementById('liveCards').innerHTML = '<div class="loading"><span class="spinner"></span>Loading live scores‚Ä¶</div>';
    try {
        const data = await apiFetch('/api/sports/live');
        liveData = data.live || [];
        renderLiveCards(liveData);
        showError('');
    } catch (err) {
        document.getElementById('liveCards').innerHTML = '<div class="empty-state">No live data available</div>';
        showError(err.message);
    }
}

async function loadUpcoming() {
    document.getElementById('upcomingCards').innerHTML = '<div class="loading"><span class="spinner"></span>Loading upcoming matches‚Ä¶</div>';
    try {
        const data = await apiFetch('/api/sports/upcoming');
        upcomingData = data.upcoming || [];
        renderUpcomingCards(upcomingData);
        showError('');
    } catch (err) {
        document.getElementById('upcomingCards').innerHTML = '<div class="empty-state">No upcoming data available</div>';
        showError(err.message);
    }
}

async function loadAll() {
    showError('');
    await Promise.all([loadLive(), loadUpcoming()]);
}

function switchTab(el, sport) {
    currentSport = sport;
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    el.classList.add('active');
    renderLiveCards(liveData);
    renderUpcomingCards(upcomingData);
}

async function openMatchAnalysis(id, title) {
    if (!id || id === 'undefined') return;
    document.getElementById('overlayTitle').textContent = title;
    document.getElementById('overlayContent').innerHTML = '<div class="loading"><span class="spinner"></span>Loading analysis‚Ä¶</div>';
    document.getElementById('overlay').classList.add('open');

    try {
        const data = await apiFetch(`/api/sports/match/${id}`);
        const m = data.match;
        const html = `
            <div style="margin-bottom:12px;display:flex;gap:16px;align-items:center">
                ${m.homeLogoUrl ? `<img src="${m.homeLogoUrl}" style="width:40px;height:40px;object-fit:contain" alt="">` : ''}
                <div>
                    <div style="font-weight:bold">${escHtml(m.homeTeam)} vs ${escHtml(m.awayTeam)}</div>
                    <div style="font-size:0.8rem;color:#888">${m.league} ‚Äî ${m.date} ${m.time || ''}</div>
                    ${m.venue ? `<div style="font-size:0.8rem;color:#666">üìç ${escHtml(m.venue)}</div>` : ''}
                </div>
                ${m.awayLogoUrl ? `<img src="${m.awayLogoUrl}" style="width:40px;height:40px;object-fit:contain;margin-left:auto" alt="">` : ''}
            </div>
            ${(m.homeScore !== null && m.homeScore !== undefined) ? `<div class="score" style="margin-bottom:12px">${m.homeScore} ‚Äì ${m.awayScore}</div>` : ''}
            <div class="form-row">
                <span style="min-width:110px;font-size:0.82rem;color:#888">${escHtml(m.homeTeam)} form:</span>
                ${renderFormPills(m.homeForm)}
            </div>
            <div class="form-row" style="margin-bottom:14px">
                <span style="min-width:110px;font-size:0.82rem;color:#888">${escHtml(m.awayTeam)} form:</span>
                ${renderFormPills(m.awayForm)}
            </div>
            <div style="font-size:0.85rem;line-height:1.6;color:#ccc;border-top:1px solid rgba(255,255,255,0.08);padding-top:12px">
                ${escHtml(data.analysis || '').replace(/\n/g, '<br>')}
            </div>`;
        document.getElementById('overlayContent').innerHTML = html;
    } catch (err) {
        document.getElementById('overlayContent').innerHTML = `<div class="error-msg">Could not load analysis: ${escHtml(err.message)}</div>`;
    }
}

function closeOverlay() {
    document.getElementById('overlay').classList.remove('open');
}

document.getElementById('overlay').addEventListener('click', function(e) {
    if (e.target === this) closeOverlay();
});

function escHtml(str) {
    if (!str) return '';
    return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');
}

// Auto-refresh live scores every 60 seconds
setInterval(loadLive, 60000);
</script>
</body>
</html>
