<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password — KelionAI</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <style>
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        :root {
            --kelion-bg: #060614;
            --kelion-surface: rgba(15, 15, 45, 0.85);
            --kelion-border: rgba(255, 255, 255, 0.1);
            --kelion-primary: #00ccff;
            --kelion-secondary: #8855ff;
            --kelion-text: #e8e8f0;
            --kelion-muted: #8888aa;
            --kelion-radius: 12px;
            --kelion-font: 'Inter', sans-serif;
        }
        body {
            background: var(--kelion-bg);
            color: var(--kelion-text);
            font-family: var(--kelion-font);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 24px;
        }
        .card {
            background: var(--kelion-surface);
            border: 1px solid var(--kelion-border);
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            backdrop-filter: blur(20px);
        }
        .logo { text-align: center; margin-bottom: 32px; }
        .logo h1 { font-size: 1.8rem; font-weight: 700; background: linear-gradient(135deg, #00ccff, #8855ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .logo p { color: var(--kelion-muted); font-size: 0.9rem; margin-top: 8px; }
        h2 { font-size: 1.2rem; font-weight: 600; margin-bottom: 20px; }
        input {
            width: 100%; padding: 12px 16px; border-radius: var(--kelion-radius);
            border: 1px solid var(--kelion-border); background: rgba(255,255,255,0.05);
            color: var(--kelion-text); font-family: var(--kelion-font); font-size: 1rem;
            outline: none; margin-bottom: 12px; transition: border-color 0.2s;
        }
        input:focus { border-color: var(--kelion-primary); }
        button {
            width: 100%; padding: 12px; border-radius: var(--kelion-radius);
            border: none; background: linear-gradient(135deg, #00ccff, #8855ff);
            color: #fff; font-family: var(--kelion-font); font-size: 1rem;
            font-weight: 600; cursor: pointer; transition: opacity 0.2s;
        }
        button:hover { opacity: 0.9; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        #msg { margin-top: 12px; font-size: 0.9rem; min-height: 20px; text-align: center; }
        .back-link { display: block; text-align: center; margin-top: 20px; color: var(--kelion-muted); font-size: 0.85rem; text-decoration: none; }
        .back-link:hover { color: var(--kelion-primary); }
    </style>
</head>
<body>
    <div class="card">
        <div class="logo">
            <h1>KelionAI</h1>
            <p>Password Reset</p>
        </div>
        <h2>Set New Password</h2>
        <input type="password" id="new-password" placeholder="New password (min 6 characters)" autocomplete="new-password" required minlength="6">
        <input type="password" id="confirm-password" placeholder="Confirm new password" autocomplete="new-password" required minlength="6">
        <button id="submit-btn">Reset Password</button>
        <div id="msg"></div>
        <a href="/" class="back-link">← Back to Sign In</a>
    </div>
    <script>
    (function() {
        'use strict';
        const API = window.location.origin;

        function getHashParam(key) {
            const hash = window.location.hash.substring(1);
            const params = new URLSearchParams(hash);
            return params.get(key);
        }

        const accessToken = getHashParam('access_token');
        const msgEl = document.getElementById('msg');
        const btn = document.getElementById('submit-btn');

        if (!accessToken) {
            msgEl.style.color = '#ff4444';
            msgEl.textContent = 'Invalid or missing reset token. Please request a new password reset link.';
            btn.disabled = true;
        }

        btn.addEventListener('click', async () => {
            const pw = document.getElementById('new-password').value;
            const pw2 = document.getElementById('confirm-password').value;
            msgEl.style.color = '';
            if (!pw || pw.length < 6) { msgEl.style.color = '#ff4444'; msgEl.textContent = 'Password must be at least 6 characters.'; return; }
            if (pw !== pw2) { msgEl.style.color = '#ff4444'; msgEl.textContent = 'Passwords do not match.'; return; }
            btn.disabled = true; btn.textContent = '...';
            try {
                const r = await fetch(API + '/api/auth/reset-password', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ access_token: accessToken, password: pw })
                });
                const d = await r.json();
                if (!r.ok) { msgEl.style.color = '#ff4444'; msgEl.textContent = d.error || 'Reset failed.'; }
                else {
                    msgEl.style.color = '#00ff88';
                    msgEl.textContent = 'Password updated successfully! Redirecting to sign in…';
                    setTimeout(() => { window.location.href = '/'; }, 2000);
                }
            } catch(e) {
                msgEl.style.color = '#ff4444'; msgEl.textContent = 'Network error. Please try again.';
            } finally { btn.disabled = false; btn.textContent = 'Reset Password'; }
        });
    })();
    </script>
</body>
</html>
